import{a as z,b as q,c as K,d as F,e as J,f as G,g as Q,h as w,i as X}from"./chunk-653C6EZZ.min.js";import{a as W}from"./chunk-EMCWWMW2.min.js";import"./chunk-AYWJFWG7.min.js";import"./chunk-VOX4EF2A.min.js";import"./chunk-6VUBUJZO.min.js";import{a as Y}from"./chunk-CKZNVD2G.min.js";import"./chunk-O63KHJZD.min.js";import"./chunk-5XLKQJ5Y.min.js";import{N as V,a as at,p as U}from"./chunk-F2VOIZPW.min.js";import{J as g,a as ct,b as lt,f as a,k as y,u as f}from"./chunk-JL6ISKUC.min.js";import{d as $}from"./chunk-CCEUEXYU.min.js";var Ut=$(ct(),1);var Vt=$(lt(),1);var qt=$(at(),1);var R="rect",N="rectWithTitle",dt="start",Et="end",pt="divider",St="roundedWithTitle",Tt="note",_t="noteGroup",_="statediagram",ut="state",Dt=`${_}-${ut}`,j="transition",ft="note",At="note-edge",bt=`${j} ${At}`,ht=`${_}-${ft}`,yt="cluster",gt=`${_}-${yt}`,Rt="cluster-alt",xt=`${_}-${Rt}`,I="parent",tt="note",Ct="state",k="----",$t=`${k}${tt}`,Z=`${k}${I}`,et="fill:none",ot="fill: #333",st="c",nt="text",it="normal",x={},E=0,Gt=function(t){let n=Object.keys(t);for(let o of n)t[o]},wt=function(t,n){a.trace("Extracting classes"),n.db.clear();try{return n.parser.parse(t),n.db.extract(n.db.getRootDocV2()),n.db.getClasses()}catch(o){return o}};function Nt(t){return t==null?"":t.classes?t.classes.join(" "):""}function L(t="",n=0,o="",i=k){let r=o!==null&&o.length>0?`${i}${o}`:"";return`${Ct}-${t}${r}-${n}`}var A=(t,n,o,i,r,c)=>{let e=o.id,u=Nt(i[e]);if(e!=="root"){let S=R;o.start===!0&&(S=dt),o.start===!1&&(S=Et),o.type!==G&&(S=o.type),x[e]||(x[e]={id:e,shape:S,description:y.sanitizeText(e,f()),classes:`${u} ${Dt}`});let s=x[e];o.description&&(Array.isArray(s.description)?(s.shape=N,s.description.push(o.description)):s.description.length>0?(s.shape=N,s.description===e?s.description=[o.description]:s.description=[s.description,o.description]):(s.shape=R,s.description=o.description),s.description=y.sanitizeTextOrArray(s.description,f())),s.description.length===1&&s.shape===N&&(s.shape=R),!s.type&&o.doc&&(a.info("Setting cluster for ",e,P(o)),s.type="group",s.dir=P(o),s.shape=o.type===Q?pt:St,s.classes=s.classes+" "+gt+" "+(c?xt:""));let T={labelStyle:"",shape:s.shape,labelText:s.description,classes:s.classes,style:"",id:e,dir:s.dir,domId:L(e,E),type:s.type,padding:15};if(T.centerLabel=!0,o.note){let d={labelStyle:"",shape:Tt,labelText:o.note.text,classes:ht,style:"",id:e+$t+"-"+E,domId:L(e,E,tt),type:s.type,padding:15},b={labelStyle:"",shape:_t,labelText:o.note.text,classes:s.classes,style:"",id:e+Z,domId:L(e,E,I),type:"group",padding:0};E++;let l=e+Z;t.setNode(l,b),t.setNode(d.id,d),t.setNode(e,T),t.setParent(e,l),t.setParent(d.id,l);let h=e,p=d.id;o.note.position==="left of"&&(h=d.id,p=e),t.setEdge(h,p,{arrowhead:"none",arrowType:"",style:et,labelStyle:"",classes:bt,arrowheadStyle:ot,labelpos:st,labelType:nt,thickness:it})}else t.setNode(e,T)}n&&n.id!=="root"&&(a.trace("Setting node ",e," to be child of its parent ",n.id),t.setParent(e,n.id)),o.doc&&(a.trace("Adding nodes children "),Lt(t,o,o.doc,i,r,!c))},Lt=(t,n,o,i,r,c)=>{a.trace("items",o),o.forEach(e=>{switch(e.stmt){case F:A(t,n,e,i,r,c);break;case G:A(t,n,e,i,r,c);break;case J:{A(t,n,e.state1,i,r,c),A(t,n,e.state2,i,r,c);let u={id:"edge"+E,arrowhead:"normal",arrowTypeEnd:"arrow_barb",style:et,labelStyle:"",label:y.sanitizeText(e.description,f()),arrowheadStyle:ot,labelpos:st,labelType:nt,thickness:it,classes:j};t.setEdge(e.state1.id,e.state2.id,u,E),E++}break}})},P=(t,n=K)=>{let o=n;if(t.doc)for(let i=0;i<t.doc.length;i++){let r=t.doc[i];r.stmt==="dir"&&(o=r.value)}return o},Pt=function(t,n,o,i){a.info("Drawing state diagram (v2)",n),x={};let r=i.db.getDirection();r===void 0&&(r=q);let{securityLevel:c,state:e}=f(),u=e.nodeSpacing||50,S=e.rankSpacing||50;a.info(i.db.getRootDocV2()),i.db.extract(i.db.getRootDocV2()),a.info(i.db.getRootDocV2());let s=i.db.getStates(),T=new Y({multigraph:!0,compound:!0}).setGraph({rankdir:P(i.db.getRootDocV2()),nodesep:u,ranksep:S,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}});A(T,void 0,i.db.getRootDocV2(),s,i.db,!0);let d;c==="sandbox"&&(d=g("#i"+n));let b=c==="sandbox"?g(d.nodes()[0].contentDocument.body):g("body"),l=b.select(`[id="${n}"]`),h=b.select("#"+n+" g");W(h,T,["barb"],_,n);let p=8;V.insertTitle(l,"statediagramTitleText",e.titleTopMargin,i.db.getDiagramTitle());let v=l.node().getBBox(),O=v.width+p*2,M=v.height+p*2;l.attr("class",_);let m=l.node().getBBox();U(l,M,O,e.useMaxWidth);let B=`${m.x-p} ${m.y-p} ${O} ${M}`;a.debug(`viewBox ${B}`),l.attr("viewBox",B);let rt=document.querySelectorAll('[id="'+n+'"] .edgeLabel .label');for(let C of rt){let H=C.getBBox(),D=document.createElementNS("http://www.w3.org/2000/svg",R);D.setAttribute("rx",0),D.setAttribute("ry",0),D.setAttribute("width",H.width),D.setAttribute("height",H.height),C.insertBefore(D,C.firstChild)}},kt={setConf:Gt,getClasses:wt,draw:Pt},Kt={parser:z,db:w,renderer:kt,styles:X,init:t=>{t.state||(t.state={}),t.state.arrowMarkerAbsolute=t.arrowMarkerAbsolute,w.clear()}};export{Kt as diagram};
//# sourceMappingURL=stateDiagram-v2-9765461d-OKIF52RN.min.js.map
