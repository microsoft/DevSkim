# Azure Pipelines
# https://aka.ms/yaml

# name: DevSkim_VisualStudio_PR_$(SourceBranchName)_$(Date:yyyyMMdd)$(Rev:.r)
# trigger: none
# pr:
#   branches:
#     include:
#     - main
#   paths:
#     include:
#     - Pipelines/vs/devskim-visualstudio-pr.yml
#     - DevSkim-DotNet/Microsoft.DevSkim
#     - DevSkim-DotNet/Microsoft.DevSkim.VSExtension
#     - rules

# resources:
#   repositories:
#     - repository: templates
#       type: git
#       name: SecurityEngineering/OSS-Tools-Pipeline-Templates
#       ref: refs/tags/v1.0.4

# stages:
# - stage: SDL
#   dependsOn: []
#   jobs:
#   - template: sdl-job.yml@templates
#     parameters:
#       serviceTreeID: '9792b8d3-bc2c-432c-8fc9-bdb143552208'

# - stage: Build
#   dependsOn: []
#   jobs:
#   - job: build_extension
#     displayName: Build Visual Studio Extension
#     pool:
#       name: 'OSS-Tools-1ESPool'
#       vmImage: 'windows-latest'
#     steps:
#     - task: UseDotNet@2
#       inputs:
#         packageType: 'sdk'
#         version: '7.0.x'
#     - task: NuGetToolInstaller@1
#       inputs:
#         versionSpec: '6.x'
#     - task: NuGetCommand@2
#       inputs:
#         command: 'restore'
#         restoreSolution: 'DevSkim-DotNet/Microsoft.DevSkim.sln'
#         feedsToUse: 'select'
#     - task: MSBuild@1
#       displayName: MSBuild VSExtension
#       inputs:
#         solution: 'DevSkim-DotNet/Microsoft.DevSkim.VSExtension'
#         msbuildArguments: '/p:Configuration=Release /p:OutputPath=$(Build.BinariesDirectory)/visualstudio/DevSkim_$(ReleaseVersion) /p:DebugType=None'
#         restoreNugetPackages: false
#         msbuildVersion: 'latest'
#     - task: AntiMalware@3
#       displayName: Anti-Malware Scan
#       inputs:
#         InputType: 'Basic'
#         ScanType: 'CustomScan'
#         FileDirPath: '$(Build.BinariesDirectory)'
#         EnableServices: true
#         SupportLogOnError: false
#         TreatSignatureUpdateFailureAs: 'Warning'
#         SignatureFreshness: 'UpToDate'
#         TreatStaleSignatureAs: 'Warning'
#     - task: PowerShell@2
#       displayName: Move Extension File
#       inputs:
#         targetType: 'inline'
#         script: 'mv $env:BUILD_BINARIESDIRECTORY/visualstudio/DevSkim_$(ReleaseVersion)/*.vsix $env:BUILD_STAGINGDIRECTORY'
#     - task: PublishBuildArtifacts@1
#       displayName: Publish Unsigned Artifact
#       inputs:
#         PathtoPublish: '$(Build.StagingDirectory)'
#         ArtifactName: 'Unsigned_Extension'
#         publishLocation: 'Container'
